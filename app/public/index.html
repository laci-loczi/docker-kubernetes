<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K8s Cluster</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <div class="brand">
            <div class="subtitle">
                <span id="connectionStatus">Serving Pod:</span>
                <span class="pod-badge" id="podName">Waiting for data...</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn-tech" onclick="toggleTechModal(true)">
                <i class="fas fa-tools"></i> Built With...
            </button>
            <button onclick="setMode('normal')">
                <i class="fas fa-chart-line"></i> Real Usage
            </button>
            <button class="active-stress" onclick="setMode('stress')">
                <i class="fas fa-fire"></i> Stress Test
            </button>
        </div>
    </header>

    <main class="dashboard-grid">
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">CPU Load</div>
                    <div class="metric-value" id="cpuValue" style="color: var(--accent-cpu)">0<span class="unit">%</span></div>
                </div>
                <i class="fas fa-server" style="color: var(--border-color); font-size: 1.5rem;"></i>
            </div>
            <div class="chart-container"><canvas id="cpuChart"></canvas></div>
        </div>

        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">Memory Usage</div>
                    <div class="metric-value" id="memValue" style="color: var(--accent-mem)">0<span class="unit">%</span></div>
                    <div class="sub-metric">
                        <span id="memAbs">0 / 0 B</span>
                    </div>
                </div>
                <i class="fas fa-memory" style="color: var(--border-color); font-size: 1.5rem;"></i>
            </div>
            <div class="chart-container"><canvas id="memChart"></canvas></div>
        </div>
    </main>

    <section style="margin-top: 40px; width: 100%;">
        <div class="card">
            <div class="card-header" style="margin-bottom: 15px;">
                <div>
                    <div class="card-title">K8s Vision Engine & Load Balancer Test</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 5px;">
                        Turn picture into ASCII with different options!
                    </div>
                </div>
                <i class="fas fa-satellite-dish" style="color: var(--border-color); font-size: 1.5rem;"></i>
            </div>
            
            <div style="background: rgba(15, 23, 42, 0.5); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 20px; align-items: center;">
                
                <div>
                    <input type="file" id="imageInput" accept="image/*" style="background: var(--bg-color); color: var(--text-main); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer; max-width: 200px;">
                </div>
                
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;">Task:</span>
                    <select id="taskMode" style="background: var(--bg-color); color: var(--text-main); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                        <option value="both">ASCII + AI (K8s + Edge)</option>
                        <option value="ascii">ASCII Only (K8s)</option>
                        <option value="ai">Original Image + AI (Edge)</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;">Style:</span>
                    <select id="renderMode" style="background: var(--bg-color); color: var(--text-main); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                        <option value="color">True Color (Basic)</option>
                        <option value="topology">Topology Map (Pod's color)</option>
                        <option value="matrix">Edgy Matrix Rain</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;">Grid: </span>
                    <select id="gridSize" style="background: var(--bg-color); color: var(--text-main); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer;">
                        <option value="8" style="color: #8ccc15;">8 * 8 (Normal)</option>
                        <option value="16" style="color: #ee9d33;" > 16 * 16 (Heavy)</option>
                        <option value="32" style="color: #ef4444; font-weight: bold;">32 * 32 (Very Heavy)</option>
                    </select>
                </div>

                <button onclick="startDistributedRender()" style="background: var(--accent-mem); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; margin-left: auto; transition: 0.2s; box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);">
                    <i class="fas fa-bolt"></i> Execute Render
                </button>
            </div>

            <div style="display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap;">
                
                <div id="renderGrid" style="display: grid; background: #000; border-radius: 8px; overflow: hidden; font-family: 'Courier New', Courier, monospace; letter-spacing: 0; font-weight: bold; white-space: pre; box-shadow: 0 4px 15px rgba(0,0,0,0.5); min-width: 300px; min-height: 300px; display: flex; justify-content: center; align-items: center; border: 1px solid #222;">
                    <span style="color: #444; font-size: 0.9rem; font-weight: normal;">No image loaded</span>
                </div>

                <div id="podLeaderboard" style="background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; flex-grow: 1; min-width: 250px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--text-muted); border-bottom: 1px solid var(--border-color); padding-bottom: 5px; display: flex; justify-content: space-between;">
                        <span>K8s Worker Nodes</span>
                        <span id="progressText" style="color: var(--accent-mem); font-size: 0.8rem;">0%</span>
                    </h4>
                    <ul id="podList" style="list-style: none; padding: 0; margin: 0; font-size: 0.85rem;">
                        <li style="color: var(--text-muted);">Waiting for job...</li>
                    </ul>
                </div>
                <div id="aiPanel" style="background: var(--bg-color); border: 1px solid #ef4444; border-radius: 8px; padding: 15px; flex-grow: 1; min-width: 250px; display: none;">
                    <h4 style="margin: 0 0 10px 0; color: #ef4444; border-bottom: 1px solid #ef4444; padding-bottom: 5px; display: flex; justify-content: space-between;">
                        <span><i class="fas fa-crosshairs"></i> AI Engine</span>
                        <span style="font-size: 0.8rem;" id="aiStatus">Waiting...</span>
                    </h4>
                    <ul id="aiList" style="list-style: none; padding: 0; margin: 0; font-size: 0.85rem;">
                        <li style="color: var(--text-muted);">Neural Network initializing...</li>
                    </ul>
                </div>
            </div>
            
            <canvas id="hiddenCanvas" style="display: none;"></canvas>
        </div>
        
        <div id="techModalOverlay" class="modal-overlay" onclick="if(event.target === this) toggleTechModal(false)">
            <div class="modal-content" id="techModalContent">
                <div class="modal-header">
                    <h2 style="margin: 0; font-size: 1.25rem; font-weight: 600;"><i class="fas fa-sitemap" style="color: var(--accent-mem); margin-right: 10px;"></i> System Architecture & Tech Stack</h2>
                    <button class="modal-close" onclick="toggleTechModal(false)"><i class="fas fa-times"></i></button>
                </div>
                
                <div class="tech-grid-layout">
                    <div class="tech-category">
                        <h4><i class="fas fa-cubes" style="color: #3b82f6;"></i> Cloud & Infrastructure</h4>
                        <ul class="tech-list">
                            <li><span>Docker</span></li>
                            <li><span>Kubernetes (K8s)</span></li>                         
                            <li><span>Jenkins:</span> CI/CD pipeline.</li>
                        </ul>
                    </div>

                    <div class="tech-category">
                        <h4><i class="fas fa-shield-alt" style="color: #10b981;"></i> Network & Security</h4>
                        <ul class="tech-list">
                            <li><span>Cloudflare Tunnels:</span> Zero Trust secure edge routing.</li>
                            <li><span>NGINX:</span> Reverse proxy & Load balancing.</li>
                        </ul>
                    </div>

                    <div class="tech-category">
                        <h4><i class="fas fa-server" style="color: #ef4444;"></i> Backend & Messaging</h4>
                        <ul class="tech-list">
                            <li><span>Node.js:</span> Async processing, DDoS rate limiting.</li>
                            <li><span>Redis:</span> Message Broker (Pub/Sub & Task Queues).</li>
                            <li><span>Socket.io:</span> Real-time bi-directional streaming.</li>
                        </ul>
                    </div>

                    <div class="tech-category">
                        <h4><i class="fas fa-brain" style="color: #8b5cf6;"></i> AI & Frontend</h4>
                        <ul class="tech-list">
                            <li><span>Transformers.js (YOLOS):</span> Real-time client-side Edge AI inference.</li>
                            <li><span>Chart.js:</span> Live CPU/Memory telemetry visualization.</li>
                        </ul>
                    </div>
                </div>
                
                <div style="margin-top: 20px; font-size: 0.8rem; color: var(--text-muted); text-align: center; border-top: 1px solid var(--border-color); padding-top: 15px;">
                    Designed for scalable, fault-tolerant, and event-driven computing.
                </div>
            </div>
        </div>
    </section>
    
    <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Real-Time System Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; color: #1f2937; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        /* √öJ: Pod n√©v st√≠lusa */
        .pod-info { font-size: 0.9rem; color: #6b7280; margin-top: 5px; }
        .pod-id { font-weight: bold; color: #4b5563; font-family: monospace; background: #e5e7eb; padding: 2px 6px; border-radius: 4px; }

        .controls { display: flex; gap: 10px; }
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: white; }
        .btn-stress { background-color: #ef4444; }
        .btn-normal { background-color: #10b981; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 80vh; }
        
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        h2 { margin: 0 0 10px 0; font-size: 1.2rem; display: flex; justify-content: space-between; }
        
        .chart-box { flex-grow: 1; position: relative; }
        .stat-big { font-size: 2rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1 style="margin: 0;">üî• Kubernetes Real-Time Monitor</h1>
            <div class="pod-info">Kiszolg√°l√≥ Pod: <span id="podName" class="pod-id">Csatlakoz√°s...</span></div>
        </div>
        <div class="controls">
            <button class="btn-normal" onclick="setMode('normal')">üü¢ Norm√°l</button>
            <button class="btn-stress" onclick="setMode('stress')">üî¥ Hardcore Terhel√©s</button>
        </div>
    </div>

    <div class="dashboard">
        
        <div class="card">
            <h2>
                CPU Haszn√°lat
                <span id="cpuValue" class="stat-big" style="color: #ef4444;">0%</span>
            </h2>
            <div class="chart-box">
                <canvas id="cpuChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>
                Mem√≥ria Haszn√°lat
                <span id="memValue" class="stat-big" style="color: #3b82f6;">0%</span>
            </h2>
            <div class="chart-box">
                <canvas id="memChart"></canvas>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // --- CPU Chart ---
        const cpuCtx = document.getElementById('cpuChart').getContext('2d');
        const cpuChart = new Chart(cpuCtx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [{
                    label: 'CPU %',
                    data: Array(20).fill(0),
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.2)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: { y: { min: 0, max: 100 } },
                plugins: { legend: { display: false } }
            }
        });

        // --- Mem√≥ria Chart ---
        const memCtx = document.getElementById('memChart').getContext('2d');
        const memChart = new Chart(memCtx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [{
                    label: 'RAM %',
                    data: Array(20).fill(0),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: { y: { min: 0, max: 100 } },
                plugins: { legend: { display: false } }
            }
        });

        // --- ADATOK FOGAD√ÅSA ---
        
        // 1. Kezdeti inf√≥ (hogy ne kelljen v√°rni az els≈ë m√©r√©sig)
        socket.on('init info', (data) => {
            document.getElementById('podName').textContent = data.hostname;
        });

        // 2. Folyamatos friss√≠t√©s
        socket.on('stats update', (data) => {
            // Pod n√©v friss√≠t√©se (ha esetleg √∫jraindulna √©s v√°ltozna)
            document.getElementById('podName').textContent = data.hostname;

            // CPU
            document.getElementById('cpuValue').textContent = data.cpu + '%';
            const cpuData = cpuChart.data.datasets[0].data;
            cpuData.shift();
            cpuData.push(data.cpu);
            cpuChart.update();

            // Mem√≥ria
            document.getElementById('memValue').textContent = data.mem + '%';
            const memData = memChart.data.datasets[0].data;
            memData.shift();
            memData.push(data.mem);
            memChart.update();
        });

        // --- Vez√©rl√©s ---
        function setMode(mode) {
            let password = null;
            if (mode === 'stress') {
                password = prompt("Jelsz√≥ a terhel√©shez:");
                if (!password) return;
            }
            socket.emit('change mode', { mode, password });
        }
        
        socket.on('auth error', (msg) => alert("‚õî " + msg));
    </script>
</body>
</html>